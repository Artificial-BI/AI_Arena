# # AI Arena

## Цели и задачи проекта

Цель проекта AI Arena – создать сетевую игру, где игроки могут создавать уникальных персонажей, описывать их текстово, и с помощью нейросети видеть визуализацию этих персонажей, участвовать в поединках и соревноваться с другими игроками. Проект использует возможности мультимодальной модели Google Gemini для генерации изображений, описаний и анализа боев.

### Задачи проекта:
1. Обеспечить платформу для создания и управления персонажами.
2. Создать динамичную механику боя с использованием нейросетей.
3. Внедрить автоматический, полуавтоматический и ручной режимы игры.
4. Обеспечить удобный интерфейс для игроков, администраторов и зрителей.
5. Реализовать систему коммуникации и модерации чата с автоматическим переводом сообщений.
6. Использовать возможности мультимодальной модели Google Gemini для генерации изображений и описаний персонажей, анализа боев и создания видеоматериалов.

## Интерфейсы

### Главная страница
1. Турнирная таблица с топ-игроками и их статистикой.
2. График побед-поражений для первых десяти игроков.
3. Слайдеры для арен и персонажей.
4. Слайдер с видео боёв.
5. Гиф-изображения с боями на арене.
6. Шапка с логотипом, названием, описанием платформы, кнопками регистрации и входа, а также меню с пунктами «Главная», «Зритель».
7. Подвал:
   - Контактная информация (адрес электронной почты или форма обратной связи).
   - Ссылки на социальные сети.
   - Политика конфиденциальности и условия использования.
   - Ссылки на другие важные страницы (например, страница помощи или часто задаваемых вопросов).
   - Информация об авторских правах.

### Интерфейс игрока
1. **Изображение персонажа, график характеристик:**
   - Поле для отображения сгенерированного нейросетью изображения персонажа (img).
   - График характеристик персонажа (Здоровье, Интеллект, Сила, Магия, Атака, Защита, Скорость, Ловкость, Выносливость, Удача).
2. **Характеристики игрока:**
   - Поле/список с персонажами, для ввода имени персонажа, оно же для выбора или удаления персонажа из списка.
   - Переключатель поля для ввода характеристик персонажа или тактики действий персонажа.
   - Поле для ввода характеристик/тактики действий персонажа, это же поле - чат для общения с нейросетью, 
     это же поле для ввода тактических команд.
   - Кнопка отправки сообщения.
   - Пример описания характеристик персонажа.
   - Пример описания тактики действий персонажа.
   - Кнопка для активации голосового ввода в чат с нейросетью.
   - Кнопка добавления выбранного персонажа в базу.
3. **Выбор режима игры:**
   - Кнопки для выбора режима игры: автоматический, полуавтоматический, ручной.
4. **Чат:**
   - Поле для отправки сообщений.
   - Кнопка отправки сообщения.
   - Кнопка для активации голосового ввода в чат с другими игроками.

### Интерфейс администратора
1. **Настройки нейросетей:**
   - Поле/список (ген. характеристик, тактик, рефери, комментатор, и т.д.) выбора нейросети, для которой создается/редактируется промт.
   - Поле для ввода параметров (промта) нейросетей.
   - Кнопка сохранения настроек.
   - Поле, чат с нейросетью, для тестирования выбранной нейросети.
   - Кнопка отправки сообщений.
2. **Управление пользователями:**
   - Поле для отображения списка пользователей (div).
   - Кнопка для управления пользователем.
3. **Управление чатом:**
   - Поле для отображения чата, списка сообщений с пользователями, с кнопками для удаления/редактирования сообщений.
   - Кнопка для ввода новых или отредактированных сообщений.

### Интерфейс зрителя
1. **Отображение персонажей:**
   - Поле для отображения информации о персонажах (div).
   - Поле для отображения изображений персонажей (div).
2. **Этапы боя:**
   - Поле для текстового описания боя (div).
   - Поле для отображения изображений ключевых моментов боя (div).

## Механика игры

### Создание персонажа:
1. Игрок вводит имя и характеристики своего персонажа.
2. Нейросеть генерирует изображение персонажа на основе описания.

### Механика боя:
1. Назначение начальных баллов:
   - Каждому персонажу присваивается определенное количество жизненных баллов на основе его характеристик.
2. Подсчет баллов во время боя:
   - Нейросеть генерирует атаки и защиты, которые имеют определенную эффективность и силу.
   - Каждый эффективный удар отнимает определенное количество баллов у противника.
3. Определение победителя:
   - Бой продолжается до тех пор, пока у одного из персонажей не закончатся жизненные баллы.
   - Персонаж, у которого жизненные баллы достигли нуля первым, проигрывает, а его соперник объявляется победителем.
4. Бонусы за успешные и интересные ходы:
   - Нейросеть присваивает бонусные баллы за особенно удачные и интересные ходы.

### Режимы игры:
1. **Автоматический режим:**
   - Нейросеть полностью контролирует все действия и решения во время боя.
2. **Полуавтоматический режим:**
   - Игроки могут вводить команды текстом или голосом.
   - Нейросеть комбинирует предложения игроков с собственной стратегией для создания оптимальных атак и защит.
3. **Ручной режим:**
   - Игроки полностью описывают все действия своего персонажа.
   - Нейросеть не вмешивается в принятие решений, но может обрабатывать результаты действий для отображения и оценки.

## Использование возможностей модели Google Gemini
1. **Генерация изображений и описаний:**
   - Google Gemini используется для создания изображений персонажей на основе текстовых описаний игроков.
2. **Анализ боев:**
   - Нейросеть анализирует бои, генерирует текстовые описания атак и защит, присваивает баллы и определяет победителя.
3. **Создание видео после боя:**
   - Google Gemini генерирует сценарии и тексты для видео на основе текстовых описаний боя.
   - Создаются визуальные элементы и выполняется автоматический монтаж видео.
   - Сгенерированное видео публикуется на платформе для просмотра участниками и зрителями.
4. **Перевод и модерация сообщений в чате:**
   - Все сообщения автоматически переводятся на английский язык и сохраняются в базе данных.
   - Сообщения переводятся на родной язык игрока и отображаются в его окне чата.
   - Сообщения автоматически модерируются для удаления оскорблений.

## Технические требования
1. **Веб-страница:**
   - Игра будет браузерной, открываться без проблем на телефоне и компьютере.
   - Главная страница будет одностраничным приложением (SPA) с необходимой информацией.
   - Отдельные одностраничные виды для каждого игрока и отдельные виды для зрителей.
2. **Аутентификация и база данных:**
   - Использование уникальных ID на основе куков для аутентификации игроков.
   - Использование SQLite для хранения информации о игроках и их характеристиках.
   - Создание отдельной таблицы для сохранения чата и поддержка его длительное время.

## Основные компоненты класса "Ядро":
1. **Управление боями:**
   - Организация и проведение боёв между персонажами.
   - Подсчёт результатов боёв (победы, поражения, ничьи).
   - Запись и сохранение боёв для последующего просмотра.
2. **Управление аренами:**
   - Создание и конфигурирование арен для боёв.
   - Управление правилами и условиями боёв на различных аренах.
   - Арена будет генерироваться на основе характеристик обоих персонажей.
3. **Управление турнирами:**
   - Организация турниров с различными форматами (например, круговой турнир, плей-офф).
   - Отслеживание прогресса турниров и обновление турнирной таблицы.
4. **Интеграция с базой данных:**
   - Сохранение и загрузка данных о персонажах, боях, аренах и турнирах в базе данных (SQLite).

## Пример структуры базы данных:
1. **Персонажи (Characters):**
   - ID персонажа
   - Имя персонажа
   - Характеристики (жизненные силы, атака, защита и т.д.)
   - ID игрока
   - Дата создания
2. **Игроки (Players):**
   - ID игрока
   - Имя игрока
   - Электронная почта
   - Пароль (хранится в зашифрованном виде)
   - Дата регистрации
3. **Бои (Fights):**
   - ID боя
   - ID персонажа 1
   - ID персонажа 2
   - Результат боя (победа, поражение, ничья)
   - ID арены
   - Дата и время боя
4. **Арены (Arenas):**
   - ID арены
   - Описание арены
   - Параметры арены (ловушки, барьеры и т.д.)
5. **Турниры (Tournaments):**
   - ID турнира
   - Название турнира
   - Формат турнира (круговой, плей-офф и т.д.)
   - Дата начала
   - Дата окончания
   - Текущий этап турнира
6. **Турнирные матчи (TournamentMatches):**
   - ID матча
   - ID турнира
   - ID боя
   - Статус матча (запланирован, завершён и т.д.)
   - Дата и время матча

## Структура файлов проекта:
AI_Arena/
|
|-- images/
|-- instance/
|   |--aiarena.db
│── routes/
│   ├── __init__.py
│   ├── viewer_routes.py
│   ├── player_routes.py
│   ├── admin_routes.py
│   ├── index_routes.py
│   ├── common_routes.py
│
├── templates/
|   |-- base.html
|   |-- login.html
│   ├── viewer.html
│   ├── player.html
│   ├── admin.html
│   ├── index.html
|   |-- 404.html
|   |-- 500.html
│
├── static/
|   |-- css/
|   |   |-- admin.css
|   |   |-- base.css
|   |   |-- player.css
|   |   |-- viewer.css
|   |   
│   ├── js/
│   │   ├── scripts.js
│   │   ├── viewer.js
│   │   ├── player.js
│   │   ├── admin.js
│   │   ├── index.js
|   |   |-- game_mode.js
|   |   |-- voice_input.js
|   |-- videos/    
│
├── __init__.py
├── app.py
├── auth.py
├── config.py
├── character_manager.py
|-- core.py
├── default.py
├── exstension.py
├── gemini.py
├── inintialization.py
├── logging_config.py
├── managers.py
├── models.py
├── webhook.py

# Техническое задание для создания виртуальной битвы

## Общая структура

### Арена
- Генерация новой арены на каждый поединок.
- Считывание характеристик и описаний персонажей для создания арены.
- Сохранение арены в базу данных (таблица "Арена").

### Тактик (для каждого игрока свой ассистент)
- Считывание характеристик текущей арены, участников поединка, имен игроков и персонажей, описаний и характеристик персонажей из базы данных.
- Анализ последних ходов противников из чата арены.
- Выдача текущих рекомендаций бойцу в чат тактика (внутренний чат, только между игроком, тактиком и бойцом).

### Боец (для каждого игрока свой ассистент)
- Генерация хода текущего персонажа на основании рекомендаций тактика, пожеланий игрока и ситуации на арене.
- Запись хода в чат арены.

### Рефери
- Считывание чата арены после заданного количества кругов.
- Анализ характеристик арены и участников на основании их ходов.
- Выставление игровых баллов каждому участнику.
- Сохранение баллов в базу данных для выбора победителя.

### Комментатор
- Чтение чата арены каждые заданные круги.
- Генерация комментариев к битве на основании описанных действий.
- Сохранение комментариев в общий чат.

### Художник
- Чтение чата арены каждые несколько кругов.
- Выбор лучших эпизодов боя.
- Генерация изображений по описанию эпизодов.
- Сохранение изображений.

## Таблицы базы данных

### Арена (Arena)
- ID арены
- Описание арены
- Характеристики арены
- Дата создания

### Персонажи (Characters)
- ID персонажа
- Имя персонажа
- Характеристики
- ID игрока
- Дата создания

### Игроки (Players)
- ID игрока
- Имя игрока
- Электронная почта
- Пароль
- Дата регистрации

### Бои (Fights)
- ID боя
- ID арены
- Список ID персонажей (количество персонажей варьируется)
- Дата и время боя

### Чат Арены (ArenaChatMessage)
- ID сообщения
- ID арены
- ID персонажа
- Сообщение
- Время отправки

### Баллы (Scores)
- ID записи
- ID арены
- ID персонажа
- Баллы
- Время присвоения

## Основные шаги реализации

### Генерация арены
- Модуль генерации арены считывает характеристики персонажей и генерирует новую арену.
- Сохранение арены в базу данных.

### Генерация рекомендаций тактика
- Модуль тактика считывает данные из базы данных и генерирует рекомендации для бойцов.
- Запись рекомендаций в чат тактика.

### Генерация ходов бойцов
- Модуль бойца генерирует ходы персонажей на основании рекомендаций тактика, пожеланий игрока и ситуации на арене.
- Запись ходов в чат арены.

### Анализ боя и выставление баллов
- Модуль рефери анализирует ходы персонажей и выставляет баллы.
- Сохранение баллов в базу данных.

### Генерация комментариев
- Модуль комментатора читает чат арены и генерирует комментарии к битве.
- Запись комментариев в общий чат.

### Генерация изображений
- Модуль художника выбирает лучшие эпизоды и генерирует изображения.
- Сохранение изображений.

## Пример взаимодействия модулей

### Начало боя
- Модуль арены генерирует новую арену и сохраняет её в базу данных.
- Модули тактика генерируют рекомендации для бойцов.
- Модули бойцов генерируют ходы и записывают их в чат арены.
- Модули комментатора и художника обновляют чат и изображения каждые заданные круги.

### Ход боя
- Модули тактика продолжают генерировать рекомендации.
- Модули бойцов продолжают генерировать ходы.
- Модуль рефери оценивает ходы и выставляет баллы.
- Модули комментатора и художника обновляют чат и изображения.

### Завершение боя
- Модуль рефери определяет победителя на основании баллов.
- Модули комментатора и художника создают финальные комментарии и изображения.

=================================================================

## Моделируем настоящий виртуальный бой с тремя персонажами: 2 круга

#### Персонажи
1. **Персонаж A (Артур)**: Сила: 8, Ловкость: 6, Интеллект: 5
2. **Персонаж B (Борис)**: Сила: 7, Ловкость: 7, Интеллект: 6
3. **Персонаж C (Клара)**: Сила: 6, Ловкость: 8, Интеллект: 7

### Первый круг

1. **Генерация арены**
   - Модуль арены считывает характеристики персонажей.
   - Генерирует арену: **Арена Лавы**
     - Описание: Горячая и опасная, с лавовыми потоками, усложняющими передвижение.
     - Характеристики: Повышенная сложность передвижения, урон от окружающей среды.
   - Сохраняет арену в базу данных.

2. **Тактик**
   - Считывает характеристики арены, участников поединка, имена игроков, характеристики и описания персонажей.
   - Тактик анализирует данные и формирует рекомендации:
     - Артур: "Двигайся ближе к стенам арены, используй свою силу для мощных атак."
     - Борис: "Используй ловкость, чтобы уклоняться и быстро контратаковать."
     - Клара: "Держись подальше от лавы, атакуй издалека магией."

3. **Боец**
   - Считывает рекомендации и пожелания игроков.
   - Генерирует ходы:
     - Артур: Двигается к стенам арены и атакует Бориса мощным ударом.
     - Борис: Уклоняется от атаки Артура и контратакует быстрым ударом.
     - Клара: Держится подальше от лавы и атакует Артура магическим снарядом.
   - Записывает ходы в чат арены.

4. **Рефери**
   - Считывает ходы участников из чата арены.
   - Анализирует ходы:
     - Артур атакует Бориса, но Борис уклоняется и наносит контрудар. Артур получает урон 1 единица.
     - Клара атакует Артура магией, нанося ему 2 единицы урона.
   - Выставляет игровые баллы:
     - Артур: -3 HP (жизни), 0 баллов.
     - Борис: -1 HP, 1 балл за уклонение и контратаку.
     - Клара: 0 HP, 2 балла за успешную атаку.
   - Записывает баллы в базу данных.

5. **Комментатор**
   - Читает чат арены.
   - Генерирует комментарии:
     - "Артур делает мощный удар, но Борис уклоняется и контратакует!"
     - "Клара атакует магическим снарядом, попадая в Артура!"
   - Сохраняет комментарии в общий чат.

6. **Художник**
   - Выбирает лучшие эпизоды боя.
   - Генерирует изображения:
     - Артур атакует Бориса.
     - Клара запускает магический снаряд в Артура.
   - Сохраняет изображения.

### Второй круг

1. **Тактик**
   - Считывает обновленные данные из базы данных.
   - Анализирует последние ходы противников из чата арены.
   - Формирует новые рекомендации:
     - Артур: "Двигайся к центру арены, используй свою силу для атаки Бориса."
     - Борис: "Продолжай уклоняться и контратакуй Артура."
     - Клара: "Продолжай атаковать Артура издалека."

2. **Боец**
   - Считывает обновленные рекомендации и пожелания игроков.
   - Генерирует новые ходы:
     - Артур: Двигается к центру арены и снова атакует Бориса.
     - Борис: Уклоняется и пытается контратаковать.
     - Клара: Продолжает атаковать Артура магией.
   - Записывает ходы в чат арены.

3. **Рефери**
   - Считывает ходы участников из чата арены.
   - Анализирует новые ходы:
     - Артур атакует Бориса, но Борис снова уклоняется. Артур получает урон от лавы 1 единица.
     - Клара атакует Артура магией, нанося ему еще 2 единицы урона.
   - Выставляет игровые баллы:
     - Артур: -6 HP (жизни), 0 баллов.
     - Борис: -1 HP, 1 балл за уклонение.
     - Клара: 0 HP, 2 балла за успешную атаку.
   - Записывает баллы в базу данных.

4. **Комментатор**
   - Читает чат арены.
   - Генерирует новые комментарии:
     - "Артур снова атакует Бориса, но попадает в лаву!"
     - "Клара не дает Артуру передышки, продолжая атаковать магией!"
   - Сохраняет комментарии в общий чат.

5. **Художник**
   - Выбирает новые лучшие эпизоды боя.
   - Генерирует изображения:
     - Артур попадает в лаву.
     - Клара снова атакует Артура магией.
   - Сохраняет изображения.

### Завершение второго круга

После двух кругов рефери подводит итоги на основании выставленных баллов:
- Артур: -6 HP, 0 баллов.
- Борис: -1 HP, 2 балла.
- Клара: 0 HP, 4 балла.

Победитель: Клара

Модули комментатора и художника создают финальные комментарии и изображения:
- Комментатор: "Клара побеждает в этом поединке благодаря своей магии и стратегическому уму!"
- Художник: Генерирует изображение финальной сцены победы Клары.
